"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[5805],{8860:(e,n,i)=>{i.d(n,{xA:()=>d,yg:()=>y});var t=i(7953);function o(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function r(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,t)}return i}function a(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?r(Object(i),!0).forEach((function(n){o(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function l(e,n){if(null==e)return{};var i,t,o=function(e,n){if(null==e)return{};var i,t,o={},r=Object.keys(e);for(t=0;t<r.length;t++)i=r[t],n.indexOf(i)>=0||(o[i]=e[i]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)i=r[t],n.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}var s=t.createContext({}),p=function(e){var n=t.useContext(s),i=n;return e&&(i="function"==typeof e?e(n):a(a({},n),e)),i},d=function(e){var n=p(e.components);return t.createElement(s.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var i=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(i),u=o,y=m["".concat(s,".").concat(u)]||m[u]||c[u]||r;return i?t.createElement(y,a(a({ref:n},d),{},{components:i})):t.createElement(y,a({ref:n},d))}));function y(e,n){var i=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=i.length,a=new Array(r);a[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[m]="string"==typeof e?e:o,a[1]=l;for(var p=2;p<r;p++)a[p]=i[p];return t.createElement.apply(null,a)}return t.createElement.apply(null,i)}u.displayName="MDXCreateElement"},2487:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var t=i(4432),o=(i(7953),i(8860));const r={description:"Permissions and Roles",sidebar_position:6},a="Modular Permissions",l={unversionedId:"develop/dev-learning/permissions",id:"develop/dev-learning/permissions",title:"Modular Permissions",description:"Permissions and Roles",source:"@site/colony/develop/dev-learning/permissions.md",sourceDirName:"develop/dev-learning",slug:"/develop/dev-learning/permissions",permalink:"/next/develop/dev-learning/permissions",draft:!1,editUrl:"https://github.com/JoinColony/docs/edit/main/colony/develop/dev-learning/permissions.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{description:"Permissions and Roles",sidebar_position:6},sidebar:"develop",previous:{title:"Tasks and Payments",permalink:"/next/develop/dev-learning/tasks"},next:{title:"Reputation",permalink:"/next/develop/dev-learning/reputation"}},s={},p=[{value:"Domain permission transitivity",id:"domain-permission-transitivity",level:2},{value:"Using permissioned functions",id:"using-permissioned-functions",level:2}],d={toc:p},m="wrapper";function c(e){let{components:n,...i}=e;return(0,o.yg)(m,(0,t.A)({},d,i,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"modular-permissions"},"Modular Permissions"),(0,o.yg)("p",null,"In the full implementation of the Colony protocol, decision making will be determined by the reputation score of an account. Actions that are currently permissioned, such as moving shared funds and creating a task, will be allowed proportionate to an account's reputation score. This functionality is planned for later releases."),(0,o.yg)("p",null,"In the current ",(0,o.yg)("inlineCode",{parentName:"p"},"glider"),' release, network state changes are authorized by dedicated "authority" contracts e.g. ',(0,o.yg)("inlineCode",{parentName:"p"},"ColonyAuthority.sol"),". These are based on the ",(0,o.yg)("inlineCode",{parentName:"p"},"DSRoles")," implementation from ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/dapphub/dappsys-monolithic"},"dappsys"),". Functions decorated with the ",(0,o.yg)("inlineCode",{parentName:"p"},"auth")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"authDomain")," modifiers will perform an authorization check via the authority contracts before granting access. In future releases, this pattern will also allow us to switch to a reputation-mediated authority in colonies."),(0,o.yg)("p",null,"Roles are defined within ",(0,o.yg)("inlineCode",{parentName:"p"},"ColonyRole")," struct and grant permission to call certain functions within a specific domain of the colony. These are initialized in ",(0,o.yg)("inlineCode",{parentName:"p"},"ColonyAuthority.sol"),". An account may be given one or more of the available pre-defined roles:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Administration"),(0,o.yg)("li",{parentName:"ul"},"Funding"),(0,o.yg)("li",{parentName:"ul"},"Architecture"),(0,o.yg)("li",{parentName:"ul"},"Arbitration"),(0,o.yg)("li",{parentName:"ul"},"Root (only exists in the top-level domain)")),(0,o.yg)("p",null,"Note: Currently, the existing ",(0,o.yg)("inlineCode",{parentName:"p"},"auth")," modifier is preserved and checks for permissions in the root domain."),(0,o.yg)("p",null,"Note: Currently ",(0,o.yg)("inlineCode",{parentName:"p"},"Arbitration")," role grants permission for no functions. It is a placeholder for the dispute resolution system, to be implemented in later releases."),(0,o.yg)("h2",{id:"domain-permission-transitivity"},"Domain permission transitivity"),(0,o.yg)("p",null,(0,o.yg)("em",{parentName:"p"},"Note: Domains are currently restricted to one level below the root domain. This restriction will be removed after release.")),(0,o.yg)("p",null,"Domain permissions extend from the root domain. Permissions held in a domain are held in all child sub-domains, but not in parent domains."),(0,o.yg)("p",null,"As an example, consider this tree of domains in a colony (using domainIds as identifiers):"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"      1\n   /  |  \\\n  2   4   6\n / \\  \n3   5\n")),(0,o.yg)("p",null,"Authority in domain ",(0,o.yg)("inlineCode",{parentName:"p"},"2")," to call a permissioned function is valid in domains ",(0,o.yg)("inlineCode",{parentName:"p"},"3")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"5"),", but not ",(0,o.yg)("inlineCode",{parentName:"p"},"6"),". Authority in domain ",(0,o.yg)("inlineCode",{parentName:"p"},"1")," to call a permissioned function is valid in all subdomains."),(0,o.yg)("h2",{id:"using-permissioned-functions"},"Using permissioned functions"),(0,o.yg)("p",null,"Permissioned functions check two arguments, which are by convention the first and second ones expected in all permissioned functions:"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"_permissionDomainId"),": The domain that gives the caller the authority to execute an action\n",(0,o.yg)("inlineCode",{parentName:"p"},"_childSkillIndex"),": an index that specifies where to find the domain in which the action occurs."),(0,o.yg)("p",null,"New domains are given a unique skillId upon creation, so a colony with the following domain structure"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"      1\n   /  |  \\\n  2   4   6\n / \\  \n3   5\n")),(0,o.yg)("p",null,"might have local skillIds assigned as:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"       142\n    /   |   \\\n  147  254  696\n  / \\  \n159  307\n")),(0,o.yg)("p",null,"In this example,"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Skill ",(0,o.yg)("inlineCode",{parentName:"li"},"142")," has children: ",(0,o.yg)("inlineCode",{parentName:"li"},"[147, 159, 254, 307, 696]")),(0,o.yg)("li",{parentName:"ul"},"Skill ",(0,o.yg)("inlineCode",{parentName:"li"},"147")," has children: ",(0,o.yg)("inlineCode",{parentName:"li"},"[159, 307]")),(0,o.yg)("li",{parentName:"ul"},"Skill ",(0,o.yg)("inlineCode",{parentName:"li"},"254")," has children: ",(0,o.yg)("inlineCode",{parentName:"li"},"[]"))),(0,o.yg)("p",null,'If a user with "Admininstration" authority in domain ',(0,o.yg)("inlineCode",{parentName:"p"},"2")," wants to finalize a payment in domain ",(0,o.yg)("inlineCode",{parentName:"p"},"5"),", they would call:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"colony.finalizePayment(2, 1, _paymentId);\n")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"authDomain")," modifier performs the following checks:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Whether ",(0,o.yg)("inlineCode",{parentName:"li"},"msg.sender"),' has the "Administration" or "Root" permission in domain ',(0,o.yg)("inlineCode",{parentName:"li"},"2")),(0,o.yg)("li",{parentName:"ul"},"Whether the domain of action (in this case domain ",(0,o.yg)("inlineCode",{parentName:"li"},"5"),") is indeed a child of the permission domain ",(0,o.yg)("inlineCode",{parentName:"li"},"2"),", by checking that the second item in the ",(0,o.yg)("inlineCode",{parentName:"li"},"childSkillIndex")," matches the local skill associated with the domain, whatever that may be.   ")),(0,o.yg)("p",null,'Note: Functions authorized by the "Architecture" role check to see that the domain is strictly a child of the permission domain exclusively (not the permission domain itself).'),(0,o.yg)("p",null,"Within ",(0,o.yg)("inlineCode",{parentName:"p"},"ColonyAuthority.sol")," you will see this role implemented as both",(0,o.yg)("inlineCode",{parentName:"p"},"Architecture")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"ArchitectureSubdomain")," roles. This is in order to prohibit an architect from modifying the domain in which the role was given (which would allow them to, for example, remove their co-architect's role). Architects may alter permissions in sub-domains only."))}c.isMDXComponent=!0}}]);